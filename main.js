parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"REez":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,a=(e,t)=>{for(var r in t||(t={}))i.call(t,r)&&o(e,r,t[r]);if(n)for(var r of n(t))s.call(t,r)&&o(e,r,t[r]);return e},u=(e,n)=>t(e,r(n)),l=(t,r)=>e(t,"name",{value:r,configurable:!0}),h=(e,t)=>()=>(e&&(t=e(e=0)),t),c=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);function d(e){return e*Math.PI/180}function f(e){return 180*e/Math.PI}function m(e,t,r){return t>r?m(e,r,t):Math.min(Math.max(e,t),r)}function p(e,t,r){return e+(t-e)*r}function g(e,t,r,n,i){return n+(e-t)/(r-t)*(i-n)}function y(e,t,r,n,i){return m(g(e,t,r,n,i),n,i)}function w(...e){if(0===e.length)return w(0,0);if(1===e.length){if("number"==typeof e[0])return w(e[0],e[0]);if(b(e[0]))return w(e[0].x,e[0].y);if(Array.isArray(e[0])&&2===e[0].length)return w.apply(null,e[0])}return{x:e[0],y:e[1],clone(){return w(this.x,this.y)},add(...e){let t=w(...e);return w(this.x+t.x,this.y+t.y)},sub(...e){let t=w(...e);return w(this.x-t.x,this.y-t.y)},scale(e){return w(this.x*e,this.y*e)},dist(...e){let t=w(...e);return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))},len(){return this.dist(w(0,0))},unit(){return this.scale(1/this.len())},normal(){return w(this.y,-this.x)},dot(...e){let t=w(...e);return w(this.x*t.x,this.y*t.y)},angle(...e){let t=w(...e);return Math.atan2(this.y-t.y,this.x-t.x)},lerp(e,t){return w(p(this.x,e.x,t),p(this.y,e.y,t))},eq(e){return this.x===e.x&&this.y===e.y},str(){return`(${this.x}, ${this.y})`}}}function v(e){return w(Math.cos(e),Math.sin(e))}function x(e,t,r){return{x:e,y:t,z:r,xy(){return w(this.x,this.y)}}}function b(e){return void 0!==e&&void 0!==e.x&&void 0!==e.y}function k(e){return void 0!==e&&void 0!==e.x&&void 0!==e.y&&void 0!==e.z}function R(e){return void 0!==e&&void 0!==e.r&&void 0!==e.g&&void 0!==e.b&&void 0!==e.a}function A(e){if(void 0!==e&&Array.isArray(e.m)&&16===e.m.length)return e}function P(...e){if(0===e.length)return E();if(1===e.length){if(R(e[0]))return E(e[0]);if(Array.isArray(e[0])&&3===e[0].length)return P.apply(null,e[0])}return E(e[0],e[1],e[2],1)}function E(...e){var t;if(0===e.length)return E(1,1,1,1);if(1===e.length){if(R(e[0]))return E(e[0].r,e[0].g,e[0].b,e[0].a);if(Array.isArray(e[0])&&4===e[0].length)return E.apply(null,e[0])}return{r:e[0],g:e[1],b:e[2],a:null!=(t=e[3])?t:1,clone(){return E(this.r,this.g,this.b,this.a)},lighten(e){return E(this.r+e,this.g+e,this.b+e,this.a)},darken(e){return this.lighten(-e)},invert(){return E(1-this.r,1-this.g,1-this.b,this.a)},isDark(e=.5){return this.r+this.g+this.b<3*e},isLight(e=.5){return this.r+this.g+this.b>3*e},eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.g&&this.a===e.a}}}function S(e,t,r,n){return{x:e,y:t,w:r,h:n,clone(){return S(this.x,this.y,this.w,this.h)},eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}}}function T(e){return{m:e?[...e]:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],clone(){return T(this.m)},mult(e){let t=[];for(let r=0;r<4;r++)for(let n=0;n<4;n++)t[4*r+n]=this.m[0+n]*e.m[4*r+0]+this.m[4+n]*e.m[4*r+1]+this.m[8+n]*e.m[4*r+2]+this.m[12+n]*e.m[4*r+3];return T(t)},multVec4(e){return{x:e.x*this.m[0]+e.y*this.m[4]+e.z*this.m[8]+e.w*this.m[12],y:e.x*this.m[1]+e.y*this.m[5]+e.z*this.m[9]+e.w*this.m[13],z:e.x*this.m[2]+e.y*this.m[6]+e.z*this.m[10]+e.w*this.m[14],w:e.x*this.m[3]+e.y*this.m[7]+e.z*this.m[11]+e.w*this.m[15]}},multVec3(e){let t=this.multVec4({x:e.x,y:e.y,z:e.z,w:1});return x(t.x,t.y,t.z)},multVec2(e){return w(e.x*this.m[0]+e.y*this.m[4]+0*this.m[8]+1*this.m[12],e.x*this.m[1]+e.y*this.m[5]+0*this.m[9]+1*this.m[13])},translate(e){return this.mult(T([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1]))},scale(e){return this.mult(T([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1]))},rotateX(e){return this.mult(T([1,0,0,0,0,Math.cos(e),-Math.sin(e),0,0,Math.sin(e),Math.cos(e),0,0,0,0,1]))},rotateY(e){return this.mult(T([Math.cos(e),0,-Math.sin(e),0,0,1,0,0,Math.sin(e),0,Math.cos(e),0,0,0,0,1]))},rotateZ(e){return this.mult(T([Math.cos(e),-Math.sin(e),0,0,Math.sin(e),Math.cos(e),0,0,0,0,1,0,0,0,0,1]))},invert(){let e=[],t=this.m[10]*this.m[15]-this.m[14]*this.m[11],r=this.m[9]*this.m[15]-this.m[13]*this.m[11],n=this.m[9]*this.m[14]-this.m[13]*this.m[10],i=this.m[8]*this.m[15]-this.m[12]*this.m[11],s=this.m[8]*this.m[14]-this.m[12]*this.m[10],o=this.m[8]*this.m[13]-this.m[12]*this.m[9],a=this.m[6]*this.m[15]-this.m[14]*this.m[7],u=this.m[5]*this.m[15]-this.m[13]*this.m[7],l=this.m[5]*this.m[14]-this.m[13]*this.m[6],h=this.m[4]*this.m[15]-this.m[12]*this.m[7],c=this.m[4]*this.m[14]-this.m[12]*this.m[6],d=this.m[5]*this.m[15]-this.m[13]*this.m[7],f=this.m[4]*this.m[13]-this.m[12]*this.m[5],m=this.m[6]*this.m[11]-this.m[10]*this.m[7],p=this.m[5]*this.m[11]-this.m[9]*this.m[7],g=this.m[5]*this.m[10]-this.m[9]*this.m[6],y=this.m[4]*this.m[11]-this.m[8]*this.m[7],w=this.m[4]*this.m[10]-this.m[8]*this.m[6],v=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*t-this.m[6]*r+this.m[7]*n,e[4]=-(this.m[4]*t-this.m[6]*i+this.m[7]*s),e[8]=this.m[4]*r-this.m[5]*i+this.m[7]*o,e[12]=-(this.m[4]*n-this.m[5]*s+this.m[6]*o),e[1]=-(this.m[1]*t-this.m[2]*r+this.m[3]*n),e[5]=this.m[0]*t-this.m[2]*i+this.m[3]*s,e[9]=-(this.m[0]*r-this.m[1]*i+this.m[3]*o),e[13]=this.m[0]*n-this.m[1]*s+this.m[2]*o,e[2]=this.m[1]*a-this.m[2]*u+this.m[3]*l,e[6]=-(this.m[0]*a-this.m[2]*h+this.m[3]*c),e[10]=this.m[0]*d-this.m[1]*h+this.m[3]*f,e[14]=-(this.m[0]*l-this.m[1]*c+this.m[2]*f),e[3]=-(this.m[1]*m-this.m[2]*p+this.m[3]*g),e[7]=this.m[0]*m-this.m[2]*y+this.m[3]*w,e[11]=-(this.m[0]*p-this.m[1]*y+this.m[3]*v),e[15]=this.m[0]*g-this.m[1]*w+this.m[2]*v;let x=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let b=0;b<4;b++)for(let t=0;t<4;t++)e[4*b+t]*=1/x;return T(e)}}}function _(e,t,r){return e+(Math.sin(r)+1)/2*(t-e)}function D(e){return{seed:e,gen(...e){if(0===e.length)return this.seed=(O*this.seed+j)%Y,this.seed/Y;if(1===e.length){if("number"==typeof e[0])return this.gen(0,e[0]);if(b(e[0]))return this.gen(w(0,0),e[0]);if(R(e[0]))return this.gen(E(0,0,0,0),e[0])}else if(2===e.length){if("number"==typeof e[0]&&"number"==typeof e[1])return this.gen()*(e[1]-e[0])+e[0];if(b(e[0])&&b(e[1]))return w(this.gen(e[0].x,e[1].x),this.gen(e[0].y,e[1].y));if(R(e[0])&&R(e[1]))return E(this.gen(e[0].r,e[1].r),this.gen(e[0].g,e[1].g),this.gen(e[0].b,e[1].b),this.gen(e[0].a,e[1].a))}}}}function F(e){N.seed=e}function M(...e){return N.gen(...e)}function I(e){return M()<=e}function L(e){return e[Math.floor(M(e.length))]}function C(e,t){return e.p2.x>=t.p1.x&&e.p1.x<=t.p2.x&&e.p2.y>=t.p1.y&&e.p1.y<=t.p2.y}function q(e,t){return e.p2.x>t.p1.x&&e.p1.x<t.p2.x&&e.p2.y>t.p1.y&&e.p1.y<t.p2.y}function B(e,t){return t.x>=e.p1.x&&t.x<=e.p2.x&&t.y>=e.p1.y&&t.y<e.p2.y}var O,j,Y,N,U=h(()=>{l(d,"deg2rad"),l(f,"rad2deg"),l(m,"clamp"),l(p,"lerp"),l(g,"map"),l(y,"mapc"),l(w,"vec2"),l(v,"vec2FromAngle"),l(x,"vec3"),l(b,"isVec2"),l(k,"isVec3"),l(R,"isColor"),l(A,"isMat4"),l(P,"rgb"),l(E,"rgba"),l(S,"quad"),l(T,"mat4"),l(_,"wave"),O=1103515245,j=12345,Y=2147483648,N=D(Date.now()),l(D,"makeRng"),l(F,"randSeed"),l(M,"rand"),l(I,"chance"),l(L,"choose"),l(C,"colRectRect"),l(q,"overlapRectRect"),l(B,"colRectPt")});function z(e,t){let r=typeof e,n=typeof t;if(r!==n)return!1;if("object"===r&&"object"===n){let r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(let i of r){let r=e[i],n=t[i];if(("function"!=typeof r||"function"!=typeof n)&&!z(r,n))return!1}return!0}return e===t}var H=h(()=>{l(z,"deepEq")});function X(e){switch(e){case"topleft":return w(-1,-1);case"top":return w(0,-1);case"topright":return w(1,-1);case"left":return w(-1,0);case"center":return w(0,0);case"right":return w(1,0);case"botleft":return w(-1,1);case"bot":return w(0,1);case"botright":return w(1,1);default:return e}}function J(e,t){let r=(()=>{switch(t.texFilter){case"linear":return e.LINEAR;case"nearest":default:return e.NEAREST}})(),n=(()=>{var r;let n=o($,ee),i=s(new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),a=null!=(r=t.clearColor)?r:E(0,0,0,1);e.clearColor(a.r,a.g,a.b,a.a),e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);let u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,4*K,e.DYNAMIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null);let l=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,l),e.bufferData(e.ELEMENT_ARRAY_BUFFER,2*K,e.DYNAMIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null);let h=s(new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2));return{drawCalls:0,lastDrawCalls:0,defProg:n,curProg:n,defTex:i,curTex:i,curUniform:{},vbuf:u,ibuf:l,vqueue:[],iqueue:[],transform:T(),transformStack:[],clearColor:a,bgTex:h}})();function i(e){return Math.log(e)/Math.log(2)%1==0}function s(t){let n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,r);let s=(()=>i(t.width)&&i(t.height)?e.REPEAT:e.CLAMP_TO_EDGE)();return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,s),e.bindTexture(e.TEXTURE_2D,null),{width:t.width,height:t.height,bind(){e.bindTexture(e.TEXTURE_2D,n)},unbind(){e.bindTexture(e.TEXTURE_2D,null)}}}function o(t=$,r=ee){let n,i=Q.replace("{{user}}",null!=t?t:$),s=Z.replace("{{user}}",null!=r?r:ee),o=e.createShader(e.VERTEX_SHADER),a=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(o,i),e.shaderSource(a,s),e.compileShader(o),e.compileShader(a),n=e.getShaderInfoLog(o))throw new Error(n);if(n=e.getShaderInfoLog(a))throw new Error(n);let u=e.createProgram();if(e.attachShader(u,o),e.attachShader(u,a),e.bindAttribLocation(u,0,"a_pos"),e.bindAttribLocation(u,1,"a_uv"),e.bindAttribLocation(u,2,"a_color"),e.linkProgram(u),(n=e.getProgramInfoLog(u))&&"\n"!==n)throw new Error(n);return{bind(){e.useProgram(u)},unbind(){e.useProgram(null)},bindAttribs(){e.vertexAttribPointer(0,3,e.FLOAT,!1,4*V,0),e.enableVertexAttribArray(0),e.vertexAttribPointer(1,2,e.FLOAT,!1,4*V,12),e.enableVertexAttribArray(1),e.vertexAttribPointer(2,4,e.FLOAT,!1,4*V,20),e.enableVertexAttribArray(2)},send(t){this.bind();for(let r in t){let n=t[r],i=e.getUniformLocation(u,r);"number"==typeof n?e.uniform1f(i,n):A(n)?e.uniformMatrix4fv(i,!1,new Float32Array(n.m)):R(n)?e.uniform4f(i,n.r,n.g,n.b,n.a):k(n)?e.uniform3f(i,n.x,n.y,n.z):b(n)&&e.uniform2f(i,n.x,n.y)}this.unbind()}}}function h(e,t,r,n){let i=e.width/t,s=1/i,o=1/(e.height/r),a={},u=n.split("").entries();for(let[l,h]of u)a[h]=w(l%i*s,Math.floor(l/i)*o);return{tex:e,map:a,qw:s,qh:o}}function c(e,t,r=n.defTex,i=n.defProg,s={}){r=null!=r?r:n.defTex,i=null!=i?i:n.defProg,(r!==n.curTex||i!==n.curProg||!z(n.curUniform,s)||n.vqueue.length+e.length*V>K||n.iqueue.length+t.length>K)&&d(),n.curTex=r,n.curProg=i,n.curUniform=s;let o=t.map(e=>e+n.vqueue.length/V),a=e.map(e=>{let t=g(n.transform.multVec2(e.pos.xy()));return[t.x,t.y,e.pos.z,e.uv.x,e.uv.y,e.color.r,e.color.g,e.color.b,e.color.a]}).flat();o.forEach(e=>n.iqueue.push(e)),a.forEach(e=>n.vqueue.push(e))}function d(){!n.curTex||!n.curProg||0===n.vqueue.length||0===n.iqueue.length||(n.curProg.send(n.curUniform),e.bindBuffer(e.ARRAY_BUFFER,n.vbuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(n.vqueue)),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.ibuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(n.iqueue)),n.curProg.bind(),n.curProg.bindAttribs(),n.curTex.bind(),e.drawElements(e.TRIANGLES,n.iqueue.length,e.UNSIGNED_SHORT,0),n.curTex.unbind(),n.curProg.unbind(),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),n.iqueue=[],n.vqueue=[],n.drawCalls++)}function f(){e.clear(e.COLOR_BUFFER_BIT),t.clearColor||M({width:Y(),height:N(),quad:S(0,0,Y()*U()/W,N()*U()/W),tex:n.bgTex}),n.drawCalls=0,n.transformStack=[],n.transform=T()}function m(){d(),n.lastDrawCalls=n.drawCalls}function p(){return n.lastDrawCalls}function g(e){return w(e.x/Y()*2-1,-e.y/N()*2+1)}function y(e){n.transform=e.clone()}function v(e){!e||0===e.x&&0===e.y||(n.transform=n.transform.translate(e))}function P(e){!e||1===e.x&&1===e.y||(n.transform=n.transform.scale(e))}function _(e){!e||(n.transform=n.transform.rotateZ(e))}function D(){n.transformStack.push(n.transform.clone())}function F(){n.transformStack.length>0&&(n.transform=n.transformStack.pop())}function M(e={}){var t,r;let n=e.width||0,i=e.height||0,s=e.pos||w(0,0),o=X(e.origin||G).dot(w(n,i).scale(-.5)),a=w(null!=(t=e.scale)?t:1),u=e.rot||0,l=e.quad||S(0,0,1,1),h=1-(null!=(r=e.z)?r:0),d=e.color||E(1,1,1,1);D(),v(s),P(a),_(u),v(o),c([{pos:x(-n/2,i/2,h),uv:w(l.x,l.y+l.h),color:d},{pos:x(-n/2,-i/2,h),uv:w(l.x,l.y),color:d},{pos:x(n/2,-i/2,h),uv:w(l.x+l.w,l.y),color:d},{pos:x(n/2,i/2,h),uv:w(l.x+l.w,l.y+l.h),color:d}],[0,1,3,1,2,3],e.tex,e.prog,e.uniform),F()}function I(e,t={}){var r;let n=null!=(r=t.quad)?r:S(0,0,1,1),i=e.width*n.w,s=e.height*n.h;M(u(a({},t),{tex:e,quad:n,width:i,height:s}))}function L(e,t,r,n={}){M(u(a({},n),{pos:e,width:t,height:r}))}function C(e,t,r,n={}){let i=X(n.origin||G).dot(w(t,r)).scale(.5),s=e.add(w(-t/2,-r/2)).sub(i),o=e.add(w(-t/2,r/2)).sub(i),a=e.add(w(t/2,r/2)).sub(i),u=e.add(w(t/2,-r/2)).sub(i);q(s,o,n),q(o,a,n),q(a,u,n),q(u,s,n)}function q(e,t,r={}){let n=r.width||1,i=e.dist(t),s=Math.PI/2-e.angle(t);M(u(a({},r),{pos:e.add(t).scale(.5),width:n,height:i,rot:s,origin:"center"}))}function B(e,t,r={}){let n=(e+"").split(""),i=t.qw*t.tex.width,s=t.qh*t.tex.height,o=w((r.size||s)/s).dot(w(r.scale||1)),a=o.x*i,u=o.y*s,l=0,h=u,c=0,d=[[]];for(let w of n)("\n"===w||!!r.width&&l+a>r.width)&&(h+=u,l=0,d.push([])),"\n"!==w&&(d[d.length-1].push(w),l+=a),c=Math.max(c,l);r.width&&(c=r.width);let f=[],m=w(r.pos||0),p=X(r.origin||G).scale(.5),g=-p.x*a-(p.x+.5)*(c-a),y=-p.y*u-(p.y+.5)*(h-u);return d.forEach((e,n)=>{let i=(c-e.length*a)*(p.x+.5);e.forEach((e,s)=>{let l=t.map[e],h=s*a,c=n*u;l&&f.push({tex:t.tex,quad:S(l.x,l.y,t.qw,t.qh),ch:e,pos:w(m.x+h+g+i,m.y+c+y),color:r.color,origin:r.origin,scale:o,z:r.z})})}),{width:c,height:h,chars:f}}function O(e,t,r={}){j(B(e,t,r))}function j(e){for(let t of e.chars)M({tex:t.tex,width:t.tex.width*t.quad.w,height:t.tex.height*t.quad.h,pos:t.pos,scale:t.scale,color:t.color,quad:t.quad,origin:"center",z:t.z})}function Y(){return e.drawingBufferWidth/U()}function N(){return e.drawingBufferHeight/U()}function U(){var e;return null!=(e=t.scale)?e:1}function H(){return n.clearColor.clone()}return f(),m(),l(i,"powerOfTwo"),l(s,"makeTex"),l(o,"makeProgram"),l(h,"makeFont"),l(c,"drawRaw"),l(d,"flush"),l(f,"frameStart"),l(m,"frameEnd"),l(p,"drawCalls"),l(g,"toNDC"),l(y,"pushMatrix"),l(v,"pushTranslate"),l(P,"pushScale"),l(function(e){!e||(n.transform=n.transform.rotateX(e))},"pushRotateX"),l(function(e){!e||(n.transform=n.transform.rotateY(e))},"pushRotateY"),l(_,"pushRotateZ"),l(D,"pushTransform"),l(F,"popTransform"),l(M,"drawQuad"),l(I,"drawTexture"),l(L,"drawRect"),l(C,"drawRectStroke"),l(q,"drawLine"),l(B,"fmtText"),l(O,"drawText"),l(j,"drawFmtText"),l(Y,"width"),l(N,"height"),l(U,"scale"),l(H,"clearColor"),{width:Y,height:N,scale:U,makeTex:s,makeProgram:o,makeFont:h,drawTexture:I,drawText:O,drawFmtText:j,drawRect:L,drawRectStroke:C,drawLine:q,fmtText:B,frameStart:f,frameEnd:m,pushTransform:D,popTransform:F,pushMatrix:y,drawCalls:p,clearColor:H}}var G,V,K,W,Q,Z,$,ee,te=h(()=>{U(),H(),G="topleft",V=9,K=65536,W=64,Q="\nattribute vec3 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec3 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n",Z="\nprecision mediump float;\n\nvarying vec3 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\treturn v_color * texture2D(u_tex, v_uv);\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n",$="\nvec4 vert(vec3 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n",ee="\nvec4 frag(vec3 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n",l(X,"originPt"),l(J,"gfxInit")});function re(e){return"pressed"===e||"rpressed"===e?"down":"released"===e?"up":e}function ne(e={}){var t,r;let n={canvas:null!=(t=e.canvas)?t:(()=>{var t;let r=document.createElement("canvas");return(null!=(t=e.root)?t:document.body).appendChild(r),r})(),keyStates:{},charInputted:[],mouseState:"up",mousePos:w(0,0),time:0,realTime:0,skipTime:!1,dt:0,scale:null!=(r=e.scale)?r:1,isTouch:!1,loopID:null,stopped:!1,fps:0,fpsBuf:[],fpsTimer:0},i={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"},s=["space","left","right","up","down","tab","f1","f2","f3","f4","f5","f6","f7","f8","f9","f10","f11"];e.fullscreen?(n.canvas.width=window.innerWidth,n.canvas.height=window.innerHeight):(n.canvas.width=(e.width||640)*n.scale,n.canvas.height=(e.height||480)*n.scale);let o=["outline: none","cursor: default"];e.crisp&&(o.push("image-rendering: pixelated"),o.push("image-rendering: crisp-edges")),n.canvas.style=o.join(";"),n.canvas.setAttribute("tabindex","0");let a=n.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0});function u(){return n.mousePos.clone()}function h(){return"pressed"===n.mouseState}function c(){return"pressed"===n.mouseState||"down"===n.mouseState}function d(){return"released"===n.mouseState}function f(e){return"pressed"===n.keyStates[e]}function m(e){return"pressed"===n.keyStates[e]||"rpressed"===n.keyStates[e]}function p(e){return"pressed"===n.keyStates[e]||"rpressed"===n.keyStates[e]||"down"===n.keyStates[e]}function g(e){return"released"===n.keyStates[e]}function y(){return[...n.charInputted]}function v(){return n.dt}function x(){return n.time}function b(){return n.fps}function k(){return n.canvas.toDataURL()}function R(e){return e&&(n.canvas.style.cursor=null!=e?e:"default"),n.canvas.style.cursor}function A(e){let t=l(r=>{let i=r/1e3,s=i-n.realTime;n.realTime=i,n.skipTime||(n.dt=s,n.time+=n.dt,n.fpsBuf.push(1/n.dt),n.fpsTimer+=n.dt,n.fpsTimer>=1&&(n.fpsTimer=0,n.fps=Math.round(n.fpsBuf.reduce((e,t)=>e+t)/n.fpsBuf.length),n.fpsBuf=[])),n.skipTime=!1,e();for(let e in n.keyStates)n.keyStates[e]=re(n.keyStates[e]);n.mouseState=re(n.mouseState),n.charInputted=[],n.stopped||(n.loopID=requestAnimationFrame(t))},"frame");n.loopID=requestAnimationFrame(t)}function P(){cancelAnimationFrame(n.loopID),n.stopped=!0}return n.isTouch="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,n.canvas.addEventListener("mousemove",e=>{n.mousePos=w(e.offsetX,e.offsetY).scale(1/n.scale)}),n.canvas.addEventListener("mousedown",()=>{n.mouseState="pressed"}),n.canvas.addEventListener("mouseup",()=>{n.mouseState="released"}),n.canvas.addEventListener("touchstart",e=>{let t=e.touches[0];n.mousePos=w(t.clientX,t.clientY).scale(1/n.scale),n.mouseState="pressed"}),n.canvas.addEventListener("touchmove",e=>{let t=e.touches[0];n.mousePos=w(t.clientX,t.clientY).scale(1/n.scale)}),n.canvas.addEventListener("keydown",e=>{let t=i[e.key]||e.key.toLowerCase();s.includes(t)&&e.preventDefault(),1===t.length&&n.charInputted.push(t),"space"===t&&n.charInputted.push(" "),e.repeat?n.keyStates[t]="rpressed":n.keyStates[t]="pressed"}),n.canvas.addEventListener("keyup",e=>{let t=i[e.key]||e.key.toLowerCase();n.keyStates[t]="released"}),n.canvas.focus(),document.addEventListener("visibilitychange",()=>{switch(document.visibilityState){case"visible":n.skipTime=!0}}),l(u,"mousePos"),l(h,"mouseClicked"),l(c,"mouseDown"),l(d,"mouseReleased"),l(f,"keyPressed"),l(m,"keyPressedRep"),l(p,"keyDown"),l(g,"keyReleased"),l(y,"charInputted"),l(v,"dt"),l(x,"time"),l(b,"fps"),l(k,"screenshot"),l(R,"cursor"),l(A,"run"),l(P,"quit"),{gl:a,mousePos:u,keyDown:p,keyPressed:f,keyPressedRep:m,keyReleased:g,mouseDown:c,mouseClicked:h,mouseReleased:d,charInputted:y,cursor:R,dt:v,time:x,fps:b,screenshot:k,run:A,quit:P}}var ie=h(()=>{U(),l(re,"processBtnState"),l(ne,"appInit")});function se(){let e=(()=>{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createGain(),r=t;return r.connect(e.destination),{ctx:e,gainNode:t,masterNode:r}})();function t(t){return void 0!==t&&(e.gainNode.gain.value=m(t,oe,ae)),e.gainNode.gain.value}function r(t,r={loop:!1,volume:1,speed:1,detune:0,seek:0}){var n;let i=!1,s=e.ctx.createBufferSource();s.buffer=t,s.loop=!!r.loop;let o=e.ctx.createGain();s.connect(o),o.connect(e.masterNode);let a=null!=(n=r.seek)?n:0;s.start(0,a);let u=e.ctx.currentTime-a,l=null,h={stop(){i||(this.pause(),u=e.ctx.currentTime)},play(t){if(!i)return;let r=s;(s=e.ctx.createBufferSource()).buffer=r.buffer,s.loop=r.loop,s.playbackRate.value=r.playbackRate.value,s.detune&&(s.detune.value=r.detune.value),s.connect(o);let n=null!=t?t:this.time();s.start(0,n),u=e.ctx.currentTime-n,i=!1,l=null},pause(){i||(s.stop(),i=!0,l=e.ctx.currentTime)},paused:()=>i,stopped:()=>i,speed:e=>(void 0!==e&&(s.playbackRate.value=m(e,ue,le)),s.playbackRate.value),detune:e=>s.detune?(void 0!==e&&(s.detune.value=m(e,he,ce)),s.detune.value):0,volume:e=>(void 0!==e&&(o.gain.value=m(e,oe,ae)),o.gain.value),loop(){s.loop=!0},unloop(){s.loop=!1},duration:()=>t.duration,time:()=>i?l-u:e.ctx.currentTime-u};return h.speed(r.speed),h.detune(r.detune),h.volume(r.volume),h}function n(){return e.ctx}return l(t,"volume"),l(r,"play"),l(n,"ctx"),{ctx:n,volume:t,play:r}}var oe,ae,ue,le,he,ce,de,fe=h(()=>{U(),oe=0,ae=3,ue=0,le=3,he=-1200,ce=1200,l(se,"audioInit")}),me=h(()=>{de="data:image/png;base64,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"});function pe(e){let t=new Image;return t.src=e,t.crossOrigin="anonymous",new Promise((r,n)=>{t.onload=(()=>{r(t)}),t.onerror=(()=>{n(`failed to load ${e}`)})})}function ge(e){return e.startsWith("data:")}function ye(e,t,r={}){let n={lastLoaderID:0,loadRoot:"",loaders:{},sprites:{},sounds:{},fonts:{},shaders:{}};function i(e){var t;let i=n.lastLoaderID;n.loaders[i]=!1,n.lastLoaderID++,e.catch(null!=(t=r.errHandler)?t:console.error).finally(()=>{n.loaders[i]=!0})}function s(){let e=0,t=0;for(let r in n.loaders)e+=1,n.loaders[r]&&(t+=1);return t/e}function o(e){return e&&(n.loadRoot=e),n.loadRoot}function a(t,r,s,o,a=we){let u=new Promise((i,u)=>{pe(ge(r)?r:n.loadRoot+r).then(r=>{let u=e.makeFont(e.makeTex(r),s,o,a);n.fonts[t]=u,i(u)}).catch(u)});return i(u),u}function u(t,r,s={sliceX:1,sliceY:1,anims:{}}){function o(t,r,i={sliceX:1,sliceY:1,gridWidth:0,gridHeight:0,anims:{}}){let s=[],o=e.makeTex(r),a=i.sliceX||o.width/(i.gridWidth||o.width),u=i.sliceY||o.height/(i.gridHeight||o.height),l=1/a,h=1/u;for(let e=0;e<u;e++)for(let t=0;t<a;t++)s.push(S(t*l,e*h,l,h));let c={tex:o,frames:s,anims:i.anims||{}};return n.sprites[t]=c,c}l(o,"loadRawSprite");let a=new Promise((e,i)=>{if(!r)return i(`expected sprite src for "${t}"`);if("string"==typeof r){pe(ge(r)?r:n.loadRoot+r).then(r=>{e(o(t,r,s))}).catch(i)}else e(o(t,r,s))});return i(a),a}function h(t,r,s,o=!1){function a(t,r,i){let s=e.makeProgram(r,i);return n.shaders[t]=s,s}l(a,"loadRawShader");let u=new Promise((e,i)=>{if(!r&&!s)return i("no shader");function u(e){return e?fetch(n.loadRoot+e).then(t=>{if(t.ok)return t.text();throw new Error(`failed to load ${e}`)}).catch(i):new Promise(e=>e(null))}if(l(u,"resolveUrl"),o)Promise.all([u(r),u(s)]).then(([r,n])=>{e(a(t,r,n))}).catch(i);else try{e(a(t,r,s))}catch(h){i(h)}});return i(u),u}function c(e,r){let s=n.loadRoot+r,o=new Promise((i,o)=>{if(!r)return o(`expected sound src for "${e}"`);"string"==typeof r&&fetch(s).then(e=>{if(e.ok)return e.arrayBuffer();throw new Error(`failed to load ${s}`)}).then(e=>new Promise((r,n)=>{t.ctx().decodeAudioData(e,r,n)})).then(t=>{n.sounds[e]=t,i(t)}).catch(o)});return i(o),o}function d(){return n.fonts[ve]}return l(i,"addLoader"),l(s,"loadProgress"),l(o,"loadRoot"),l(a,"loadFont"),l(u,"loadSprite"),l(h,"loadShader"),l(c,"loadSound"),l(d,"defFont"),a(ve,de,8,8),{loadRoot:o,loadSprite:u,loadSound:c,loadFont:a,loadShader:h,loadProgress:s,addLoader:i,defFont:d,sprites:n.sprites,fonts:n.fonts,sounds:n.sounds,shaders:n.shaders}}var we,ve,xe=h(()=>{U(),me(),we=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",ve="unscii",l(pe,"loadImg"),l(ge,"isDataUrl"),l(ye,"assetsInit")});function be(e,t,r={max:8}){var n;let i=[],s=null!=(n=r.max)?n:8;function o(){i.length>s&&(i=i.slice(0,s));let r=w(0,e.height());i.forEach((n,i)=>{let o=g(i,0,s,1,.5),a=g(i,0,s,.8,.2),u=(()=>{switch(n.type){case"info":return E(1,1,1,o);case"error":return E(1,0,.5,o)}})(),l=e.fmtText(n.msg,t.defFont(),{pos:r,origin:"botleft",color:u,size:ke/e.scale(),width:e.width()});e.drawRect(r,l.width,l.height,{origin:"botleft",color:E(0,0,0,a)}),e.drawFmtText(l),r.y-=l.height})}function a(e){console.error(e),i.unshift({type:"error",msg:e})}function u(e){i.unshift({type:"info",msg:e})}function h(){i=[]}return l(o,"draw"),l(a,"error"),l(u,"info"),l(h,"clear"),{info:u,error:a,draw:o,clear:h}}var ke,Re=h(()=>{U(),ke=16,l(be,"loggerInit")});function Ae(e){let t={},r=[],n=null;function i(){return null!==n&&1===n.readyState}function s(){let i=new WebSocket(e);return new Promise((s,o)=>{i.onopen=(()=>{s(i),n=i;for(let e of r)i.send(e)}),i.onerror=(()=>{o(`failed to connect to ${e}`)}),i.onmessage=(e=>{let r=JSON.parse(e.data);if(t[r.type])for(let n of t[r.type])n(r.data,r.id)})})}function o(e,r){t[e]||(t[e]=[]),t[e].push(r)}function a(e,t){let i=JSON.stringify({type:e,data:t});n?n.send(i):r.push(i)}function u(){n&&n.close()}return l(i,"connected"),l(s,"connect"),l(o,"recv"),l(a,"send"),l(u,"close"),{connect:s,close:u,connected:i,recv:o,send:a}}var Pe=h(()=>{l(Ae,"netInit")}),Ee=c((e,t)=>{U(),te(),ie(),fe(),xe(),Re(),Pe(),t.exports=((e={width:640,height:480,scale:1,fullscreen:!1,debug:!1,crisp:!1,canvas:null,connect:null,logMax:8,root:document.body})=>{let t=ne({width:e.width,height:e.height,scale:e.scale,fullscreen:e.fullscreen,crisp:e.crisp,canvas:e.canvas,root:e.root}),r=J(t.gl,{clearColor:e.clearColor?E(e.clearColor):void 0,scale:e.scale,texFilter:e.texFilter}),n=se(),i=ye(r,n,{errHandler:e=>{s.error(e)}}),s=be(r,i,{max:e.logMax}),o=(()=>e.connect?Ae(e.connect):null)();function h(e,t){if(!o)throw new Error("not connected to any websockets");o.recv(e,(e,r)=>{try{t(e,r)}catch(n){s.error(n)}})}function c(e,t){if(!o)throw new Error("not connected to any websockets");o.send(e,t)}function x(){return t.dt()*tt.timeScale}function b(e,t={}){let r=i.sounds[e];if(!r)throw new Error(`sound not found: "${e}"`);return n.play(r,t)}function k(e){var t;let r=z();return!(null==(t=r.layers[null!=e?e:r.defLayer])?void 0:t.noCam)}function R(e){return k(e)?z().cam.mpos:t.mousePos()}function A(e,t={}){var n;let s=(()=>"string"==typeof e?i.sprites[e]:e)();if(!s)throw new Error(`sprite not found: "${e}"`);let o=s.frames[null!=(n=t.frame)?n:0];r.drawTexture(s.tex,u(a({},t),{quad:o}))}function O(e,t={}){var n;let s=null!=(n=t.font)?n:ve,o=i.fonts[s];if(!o)throw new Error(`font not found: ${s}`);r.drawText(e,o,t)}l(h,"recv"),l(c,"send"),l(x,"dt"),l(b,"play"),l(k,"isCamLayer"),l(R,"mousePos"),l(A,"drawSprite"),l(O,"drawText");let j=980,Y="topleft",N={loaded:!1,scenes:{},curScene:null,nextScene:null};function U(e,t){N.scenes[e]={init:t,initialized:!1,events:{add:[],update:[],draw:[],destroy:[],keyDown:[],keyPress:[],keyPressRep:[],keyRelease:[],mouseClick:[],mouseRelease:[],mouseDown:[],charInput:[]},action:[],render:[],objs:new Map,lastObjID:0,timers:{},lastTimerID:0,cam:{pos:w(r.width()/2,r.height()/2),scale:w(1,1),angle:0,shake:0,mpos:w(0),matrix:T()},layers:{},defLayer:null,gravity:j,data:{}}}function z(){return N.scenes[N.curScene]}function H(){return z().data}function G(){we("`",()=>{tt.showLog=!tt.showLog,s.info(`show log: ${tt.showLog?"on":"off"}`)}),we("f1",()=>{tt.inspect=!tt.inspect,s.info(`inspect: ${tt.inspect?"on":"off"}`)}),we("f2",()=>{tt.clearLog()}),we("f8",()=>{tt.paused=!tt.paused,s.info(`${tt.paused?"paused":"unpaused"}`)}),we("f7",()=>{tt.timeScale=m(tt.timeScale-.2,0,2),s.info(`time scale: ${tt.timeScale.toFixed(1)}`)}),we("f9",()=>{tt.timeScale=m(tt.timeScale+.2,0,2),s.info(`time scale: ${tt.timeScale.toFixed(1)}`)}),we("f10",()=>{tt.stepFrame(),s.info("stepped frame")})}function V(e,...t){N.nextScene={name:e,args:[...t]}}function K(t,...r){W(t),N.curScene=t;let n=N.scenes[t];if(!n)throw new Error(`scene not found: '${t}'`);if(!n.initialized){try{n.init(...r)}catch(i){s.error(i.stack)}e.debug&&G(),n.initialized=!0}}function W(e){if(!N.scenes[e])throw new Error(`scene not found: '${e}'`);U(e,N.scenes[e].init)}function Q(e,t){let r=z();!r||(e.forEach((e,t)=>{r.layers[e]={alpha:1,order:t+1,noCam:!1}}),t&&(r.defLayer=t))}function Z(...e){let t=z().cam;return e.length>0&&(t.pos=w(...e)),t.pos.clone()}function $(...e){let t=z().cam;return e.length>0&&(t.scale=w(...e)),t.scale.clone()}function ee(e){let t=z().cam;return void 0!==e&&(t.angle=e),t.angle}function te(e){z().cam.shake=e}function re(e){let t=z();e.forEach(e=>{t.layers[e]&&(t.layers[e].noCam=!0)})}function ie(e){let t={hidden:!1,paused:!1,_tags:[],_id:null,_events:{add:[],update:[],draw:[],destroy:[],inspect:[]},use(e){if(void 0===e)return;let t=typeof e;if("string"!==t){if("object"!==t)throw new Error(`invalid comp type: ${t}`);if(Array.isArray(e))for(let t of e)this.use(t);else for(let t in e)"function"!=typeof e[t]?this[t]=e[t]:this._events[t]?this._events[t].push(e[t].bind(this)):this[t]=e[t].bind(this)}else this._tags.push(e)},exists(){return void 0!==this._id},is(e){if("*"===e)return!0;if(Array.isArray(e)){for(let t of e)if(!this._tags.includes(t))return!1;return!0}return this._tags.includes(e)},on(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)},action(e){this.on("update",e)},trigger(e,...t){if(this._events[e])for(let n of this._events[e])n.call(this,...t);let r=z().events[e];if(r)for(let n of r)this.is(n.tag)&&n.cb(this,...t)},rmTag(e){let t=this._tags.indexOf(e);t>-1&&this._tags.splice(t,1)}};t.use(e);let r=z(),n=r.lastObjID++;r.objs.set(n,t),t._id=n,t.trigger("add");for(let i of r.events.add)t.is(i.tag)&&i.cb(t);return t}function oe(e){if(!e.exists())return;let t=z();t.objs.delete(e._id);let r=t.lastObjID++;return t.objs.set(r,e),e._id=r,e}function ae(e,t,r){let n=z();n.events[e]||(n.events[e]=[]),n.events[e].push({tag:t,cb:r})}function ue(e,t){"function"==typeof e&&void 0===t?z().action.push(e):"string"==typeof e&&ae("update",e,t)}function le(e,t){"function"==typeof e&&void 0===t?z().render.push(e):"string"==typeof e&&ae("update",e,t)}function he(e,t,r){ue(e,e=>{e._checkCollisions(t,t=>{r(e,t)})})}function ce(e,t,r){ue(e,e=>{e._checkOverlaps(t,t=>{r(e,t)})})}function de(e,t){ue(e,e=>{e.isClicked()&&t(e)})}function fe(e,t){return new Promise(r=>{let n=z();n.timers[n.lastTimerID++]={time:e,cb:()=>{t&&t(),r()}}})}function me(e,t){let r=!1,n=l(()=>{r||(t(),fe(e,n))},"newF");return n(),{stop(){r=!0}}}function pe(e,t,r){if(Array.isArray(t))for(let n of t)pe(e,n,r);else z().events[e].push({key:t,cb:r})}function ge(e,t){pe("keyDown",e,t)}function we(e,t){pe("keyPress",e,t)}function xe(e,t){pe("keyPressRep",e,t)}function ke(e,t){pe("keyRelease",e,t)}function Re(e){z().events.charInput.push({cb:e})}function Pe(e){z().events.mouseDown.push({cb:e})}function Ee(e){z().events.mouseClick.push({cb:e})}function Se(e){z().events.mouseRelease.push({cb:e})}function Te(e){let t=z(),r=[...t.objs.values()].sort((e,r)=>{var n,i,s,o,a,u;return(null!=(s=null==(i=t.layers[null!=(n=e.layer)?n:t.defLayer])?void 0:i.order)?s:0)-(null!=(u=null==(a=t.layers[null!=(o=r.layer)?o:t.defLayer])?void 0:a.order)?u:0)});return e?r.filter(t=>t.is(e)):r}function _e(e,t){"function"==typeof e&&void 0===t?Te().forEach(e):"string"==typeof e&&Te(e).forEach(t)}function De(e,t){"function"==typeof e&&void 0===t?Te().reverse().forEach(e):"string"==typeof e&&Te(e).reverse().forEach(t)}function Fe(e){if(!e.exists())return;let t=z();!t||(e.trigger("destroy"),t.objs.delete(e._id),delete e._id)}function Me(e){_e(e,e=>{Fe(e)})}function Ie(e){let t=z();return void 0!==e&&(t.gravity=e),t.gravity}function Le(e){let n=z();if(!n)throw new Error(`scene not found: '${N.curScene}'`);let i=e||!tt.paused;if(i)for(let t in n.timers){let e=n.timers[t];e.time-=x(),e.time<=0&&(e.cb(),delete n.timers[t])}if(De(e=>{!e.paused&&i&&e.trigger("update")}),i)for(let t of n.action)t();let s=w(r.width(),r.height()),o=n.cam,a=v(M(0,2*Math.PI)).scale(o.shake);o.shake=p(o.shake,0,5*x()),o.matrix=T().translate(s.scale(.5)).scale(o.scale).rotateZ(o.angle).translate(s.scale(-.5)).translate(o.pos.scale(-1).add(s.scale(.5)).add(a)),o.mpos=o.matrix.invert().multVec2(t.mousePos()),_e(e=>{e.hidden||(r.pushTransform(),k(e.layer)&&r.pushMatrix(o.matrix),e.trigger("draw"),r.popTransform())});for(let t of n.render)t()}function Ce(){let e=z();for(let r of e.events.charInput)t.charInputted().forEach(r.cb);for(let r of e.events.keyDown)t.keyDown(r.key)&&r.cb();for(let r of e.events.keyPress)t.keyPressed(r.key)&&r.cb();for(let r of e.events.keyPressRep)t.keyPressedRep(r.key)&&r.cb();for(let r of e.events.keyRelease)t.keyReleased(r.key)&&r.cb();for(let r of e.events.mouseDown)t.mouseDown()&&r.cb();for(let r of e.events.mouseClick)t.mouseClicked()&&r.cb();for(let r of e.events.mouseRelease)t.mouseReleased()&&r.cb()}function qe(){var n;let s=z(),o=null,a=i.defFont(),u=E(null!=(n=e.inspectColor)?n:[0,1,1,1]);function h(e,t,n){let i=w(4).scale(1/n),s=r.fmtText(t,a,{size:12/n,pos:e.add(w(i.x,i.y))});r.drawRect(e,s.width+2*i.x,s.height+2*i.x,{color:E(0,0,0,1)}),r.drawFmtText(s)}function c(e,t){let n=k(e.layer),i=r.scale()*(n?(s.cam.scale.x+s.cam.scale.y)/2:1);n&&(r.pushTransform(),r.pushMatrix(s.cam.matrix)),t(i),n&&r.popTransform()}l(h,"drawInspectTxt"),l(c,"drawObj"),De(e=>{!e.area||e.hidden||c(e,t=>{o||e.isHovered()&&(o=e);let n=(o===e?6:2)/t,i=e._worldArea(),s=i.p2.x-i.p1.x,a=i.p2.y-i.p1.y;r.drawRectStroke(i.p1,s,a,{width:n,color:u})})}),o&&c(o,e=>{let t=R(o.layer),r=[];for(let n of o._tags)r.push(`"${n}"`);for(let n of o._events.inspect){let e=n();for(let t in e)r.push(`${t}: ${e[t]}`)}h(t,r.join("\n"),e)}),h(w(0),t.fps()+"",r.scale())}function Be(e,...n){t.run(()=>{if(r.frameStart(),N.loaded){try{if(!z())throw new Error(`scene not found: '${N.curScene}'`);Ce(),Le(),tt.inspect&&qe()}catch(a){s.error(a.stack),t.quit()}tt.showLog&&s.draw(),N.nextScene&&(K.apply(null,[N.nextScene.name,...N.nextScene.args]),N.nextScene=null)}else{let t=i.loadProgress();if(1===t)N.loaded=!0,K(e,...n),o&&o.connect().catch(s.error);else{let e=r.width()/2,n=24/r.scale(),i=w(r.width()/2,r.height()/2).sub(w(e/2,n/2));r.drawRect(w(0),r.width(),r.height(),{color:P(0,0,0)}),r.drawRectStroke(i,e,n,{width:4/r.scale()}),r.drawRect(i,e*t,n)}}r.frameEnd()})}function Oe(...e){return{pos:w(...e),move(...e){let t=w(...e),r=t.x*x(),n=t.y*x();this.pos.x+=r,this.pos.y+=n},inspect(){return{pos:`(${~~this.pos.x}, ${~~this.pos.y})`}}}}function je(...e){return 0===e.length?je(1):{scale:w(...e),flipX(e){this.scale.x=Math.sign(e)*Math.abs(this.scale.x)},flipY(e){this.scale.y=Math.sign(e)*Math.abs(this.scale.y)}}}function Ye(e){return{angle:null!=e?e:0}}function Ne(...e){return{color:E(...e)}}function Ue(e){return{origin:e}}function ze(e){return{layer:e,inspect(){var e;let t=z();return{layer:null!=(e=this.layer)?e:t.defLayer}}}}function He(e,t){var r,n;let i=z();return(null!=(r=e.layer)?r:i.defLayer)===(null!=(n=t.layer)?n:i.defLayer)}function Xe(e,r){let n={},i={};return{area:{p1:e,p2:r},areaWidth(){let{p1:e,p2:t}=this._worldArea();return t.x-e.x},areaHeight(){let{p1:e,p2:t}=this._worldArea();return t.y-e.y},isClicked(){return t.mouseClicked()&&this.isHovered()},isHovered(){return this.hasPt(R(this.layer))},isCollided(e){if(!e.area||!He(this,e))return!1;return C(this._worldArea(),e._worldArea())},isOverlapped(e){if(!e.area||!He(this,e))return!1;return q(this._worldArea(),e._worldArea())},clicks(e){this.action(()=>{this.isClicked()&&e()})},hovers(e){this.action(()=>{this.isHovered()&&e()})},collides(e,t){this.action(()=>{this._checkCollisions(e,t)})},overlaps(e,t){this.action(()=>{this._checkOverlaps(e,t)})},hasPt(e){let t=this._worldArea();return B({p1:t.p1,p2:t.p2},e)},resolve(){let e=[];return _e(t=>{if(t===this||!t.solid||!t.area||!He(this,t))return;let r=this._worldArea(),n=t._worldArea();if(!C(r,n))return;let i=r.p2.x-n.p1.x,s=n.p2.x-r.p1.x,o=r.p2.y-n.p1.y,a=n.p2.y-r.p1.y,u=Math.min(i,s,o,a),l=(()=>{switch(u){case i:return this.pos.x-=i,"right";case s:return this.pos.x+=s,"left";case o:return this.pos.y-=o,"bottom";case a:return this.pos.y+=a,"top"}})();e.push({obj:t,side:l})}),e},_checkCollisions(e,t){_e(e,e=>{this!==e&&(n[e._id]||this.isCollided(e)&&(t(e),n[e._id]=e))});for(let r in n){let e=n[r];this.isCollided(e)||delete n[r]}},_checkOverlaps(e,t){_e(e,e=>{this!==e&&(i[e._id]||this.isOverlapped(e)&&(t(e),i[e._id]=e))});for(let r in i){let e=i[r];this.isOverlapped(e)||delete i[r]}},_worldArea(){let e=this.area,t=this.pos||w(0),r=this.scale||w(1),n=t.add(e.p1.dot(r)),i=t.add(e.p2.dot(r));return{p1:w(Math.min(n.x,i.x),Math.min(n.y,i.y)),p2:w(Math.max(n.x,i.x),Math.max(n.y,i.y))}}}}function Je(e,t,r){let n=w(e,t),i=X(r||Y).dot(n).scale(-.5);return Xe(i.sub(n.scale(.5)),i.add(n.scale(.5)))}function Ge(e,t={}){let r=i.sprites[e];if(!r)throw new Error(`sprite not found: "${e}"`);let n=a({},r.frames[0]);t.quad&&(n.x+=t.quad.x*n.w,n.y+=t.quad.y*n.h,n.w*=t.quad.w,n.h*=t.quad.h);let s=r.tex.width*n.w,o=r.tex.height*n.h,u=null;return{width:s,height:o,animSpeed:t.animSpeed||.1,frame:t.frame||0,quad:t.quad||S(0,0,1,1),add(){!this.area&&!t.noArea&&this.use(Je(this.width,this.height,this.origin))},draw(){z(),r.frames[this.frame];A(r,{pos:this.pos,scale:this.scale,rot:this.angle,color:this.color,frame:this.frame,origin:this.origin,quad:this.quad,prog:i.shaders[this.shader],uniform:this.uniform})},update(){if(!u)return;let e=r.anims[u.name];u.timer+=x(),u.timer>=this.animSpeed&&(this.frame++,this.frame>e.to&&(u.loop?this.frame=e.from:(this.frame--,this.stop())),u&&(u.timer-=this.animSpeed))},play(e,t=!0){let n=r.anims[e];if(!n)throw new Error(`anim not found: ${e}`);u&&this.stop(),u={name:e,loop:t,timer:0},this.frame=n.from,this.trigger("animPlay",e)},stop(){if(!u)return;let e=u.name;u=null,this.trigger("animEnd",e)},changeSprite(e){if(!(r=i.sprites[e]))throw new Error(`sprite not found: "${e}"`);let n=a({},r.frames[0]);t.quad&&(n.x+=t.quad.x*n.w,n.y+=t.quad.y*n.h,n.w*=t.quad.w,n.h*=t.quad.h),this.width=r.tex.width*n.w,this.height=r.tex.height*n.h,this.area&&!t.noArea&&this.use(Je(this.width,this.height,this.origin)),u=null,this.frame=0},numFrames:()=>r.frames.length,curAnim:()=>null==u?void 0:u.name,inspect(){let e={};return u&&(e.curAnim=`"${u.name}"`),e}}}function Ve(e,t,n={}){return{text:e,textSize:t,font:n.font,width:0,height:0,add(){var e,t,s;if(!this.area&&!n.noArea){z();let o=i.fonts[null!=(e=this.font)?e:ve],a=r.fmtText(this.text+"",o,{pos:this.pos,scale:this.scale,rot:this.angle,size:this.textSize,origin:this.origin,color:this.color,width:n.width});this.width=a.width/((null==(t=this.scale)?void 0:t.x)||1),this.height=a.height/((null==(s=this.scale)?void 0:s.y)||1),this.use(Je(this.width,this.height,this.origin))}},draw(){var e;z();let t=i.fonts[null!=(e=this.font)?e:ve],s=r.fmtText(this.text+"",t,{pos:this.pos,scale:this.scale,rot:this.angle,size:this.textSize,origin:this.origin,color:this.color,width:n.width});this.width=s.width,this.height=s.height,r.drawFmtText(s)}}}function Ke(e,t,n={}){return{width:e,height:t,add(){!this.area&&!n.noArea&&this.use(Je(this.width,this.height,this.origin))},draw(){z();r.drawRect(this.pos,this.width,this.height,{scale:this.scale,rot:this.angle,color:this.color,origin:this.origin,prog:i.shaders[this.shader],uniform:this.uniform})}}}function We(){return{solid:!0}}l(U,"scene"),l(z,"curScene"),l(H,"sceneData"),l(G,"regDebugInputs"),l(V,"go"),l(K,"goSync"),l(W,"reload"),l(Q,"layers"),l(Z,"camPos"),l($,"camScale"),l(ee,"camRot"),l(te,"camShake"),l(re,"camIgnore"),l(ie,"add"),l(oe,"readd"),l(ae,"on"),l(ue,"action"),l(le,"render"),l(he,"collides"),l(ce,"overlaps"),l(de,"clicks"),l(fe,"wait"),l(me,"loop"),l(pe,"pushKeyEvent"),l(ge,"keyDown"),l(we,"keyPress"),l(xe,"keyPressRep"),l(ke,"keyRelease"),l(Re,"charInput"),l(Pe,"mouseDown"),l(Ee,"mouseClick"),l(Se,"mouseRelease"),l(Te,"get"),l(_e,"every"),l(De,"revery"),l(Fe,"destroy"),l(Me,"destroyAll"),l(Ie,"gravity"),l(Le,"gameFrame"),l(Ce,"handleEvents"),l(qe,"drawInspect"),l(Be,"start"),l(Oe,"pos"),l(je,"scale"),l(Ye,"rotate"),l(Ne,"color"),l(Ue,"origin"),l(ze,"layer"),l(He,"isSameLayer"),l(Xe,"area"),l(Je,"getAreaFromSize"),l(Ge,"sprite"),l(Ve,"text"),l(Ke,"rect"),l(We,"solid");let Qe=960,Ze=480;function $e(e={}){var t,r;let n=0,i=null,s=null,o=null!=(t=e.maxVel)?t:Qe;return{jumpForce:null!=(r=e.jumpForce)?r:Ze,update(){this.move(0,n);let e=this.resolve(),t=!1;if(i&&(i.exists()&&this.isCollided(i)?s&&(this.pos=this.pos.add(i.pos.sub(s)),s=i.pos.clone()):(i=null,s=null,t=!0)),!i){n=Math.min(n+Ie()*x(),o);for(let r of e)"bottom"===r.side&&n>0?(i=r.obj,n=0,s=i.pos.clone(),t||this.trigger("grounded",i)):"top"===r.side&&n<0&&(n=0,this.trigger("headbump",r.obj))}},curPlatform:()=>i,grounded:()=>null!==i,falling:()=>n>0,jump(e){i=null,n=-e||-this.jumpForce}}}function et(e,t={}){i.shaders[e];return{shader:e,uniform:t}}l($e,"body"),l(et,"shader");let tt={paused:!1,inspect:!1,timeScale:1,showLog:!0,fps:t.fps,objCount:()=>z().objs.size,stepFrame(){Le(!0)},drawCalls:r.drawCalls,clearLog:s.clear,log:s.info,error:s.error};function rt(e,t){let r=[],n=w(t.pos||0),i=0,s={getPos(...e){let r=w(...e);return w(n.x+r.x*t.width,n.y+r.y*t.height)},spawn(e,i){let s=(()=>{if(Array.isArray(e))return e;if(t[e]){if("function"==typeof t[e])return t[e]();if(Array.isArray(t[e]))return[...t[e]]}else if(t.any)return t.any(e)})();if(!s)return;s.push(Oe(n.x+i.x*t.width,n.y+i.y*t.height));let o=ie(s);return r.push(o),o.use({gridPos:i.clone(),setGridPos(e){this.gridPos=e.clone(),this.pos=w(n.x+this.gridPos.x*t.width,n.y+this.gridPos.y*t.height)},moveLeft(){this.setGridPos(this.gridPos.add(w(-1,0)))},moveRight(){this.setGridPos(this.gridPos.add(w(1,0)))},moveUp(){this.setGridPos(this.gridPos.add(w(0,-1)))},moveDown(){this.setGridPos(this.gridPos.add(w(0,1)))}}),o},width:()=>i*t.width,height:()=>e.length*t.height,destroy(){for(let e of r)Fe(e)}};return e.forEach((e,t)=>{let r=e.split("");i=Math.max(r.length,i),r.forEach((e,r)=>{s.spawn(e,w(r,t))})}),s}l(rt,"addLevel");let nt={start:Be,loadRoot:i.loadRoot,loadSprite:i.loadSprite,loadSound:i.loadSound,loadFont:i.loadFont,loadShader:i.loadShader,addLoader:i.addLoader,width:r.width,height:r.height,dt:x,time:t.time,screenshot:t.screenshot,scene:U,go:V,sceneData:H,layers:Q,camPos:Z,camScale:$,camRot:ee,camShake:te,camIgnore:re,gravity:Ie,add:ie,readd:oe,destroy:Fe,destroyAll:Me,get:Te,every:_e,revery:De,send:c,recv:h,pos:Oe,scale:je,rotate:Ye,color:Ne,origin:Ue,layer:ze,area:Xe,sprite:Ge,text:Ve,rect:Ke,solid:We,body:$e,shader:et,on:ae,action:ue,render:le,collides:he,overlaps:ce,clicks:de,keyDown:ge,keyPress:we,keyPressRep:xe,keyRelease:ke,charInput:Re,mouseDown:Pe,mouseClick:Ee,mouseRelease:Se,mousePos:R,cursor:t.cursor,keyIsDown:t.keyDown,keyIsPressed:t.keyPressed,keyIsPressedRep:t.keyPressedRep,keyIsReleased:t.keyReleased,mouseIsDown:t.mouseDown,mouseIsClicked:t.mouseClicked,mouseIsReleased:t.mouseReleased,loop:me,wait:fe,play:b,volume:n.volume,makeRng:D,rand:M,randSeed:F,vec2:w,rgb:P,rgba:E,quad:S,choose:L,chance:I,lerp:p,map:g,mapc:y,wave:_,deg2rad:d,rad2deg:f,drawSprite:A,drawText:O,drawRect:r.drawRect,drawRectStroke:r.drawRectStroke,drawLine:r.drawLine,debug:tt,addLevel:rt};if(e.plugins)for(let a of e.plugins){let e=a(nt);for(let t in e)nt[t]=e[t]}if(e.global)for(let a in nt)window[a]=nt[a];return nt})}),Se=Ee();exports.default=Se;
},{}],"epB2":[function(require,module,exports) {
"use strict";var e=r(require("kaboom"));function r(e){return e&&e.__esModule?e:{default:e}}(0,e.default)({fullscreen:!0,clearColor:[0,0,0,1]});
},{"kaboom":"REez"}]},{},["epB2"], null)
//# sourceMappingURL=/main.js.map